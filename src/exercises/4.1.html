<!DOCTYPE html>
<!--
ðŸ§© 4.1: More meaningful content
ðŸŽ¯ Goal: Improve the accessibility of each case
-->
<html lang="en">

<head>
  <title>Exercise #4.1</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/theme.css">
  <link rel="stylesheet" href="4.1.css">
</head>

<body>
  <main class="content">
    <h1 class="title-xl">Loading states</h1>

    <div class="g-card">
      <form novalidate>
        <button class="btn btnPrimary js-luckyTrigger">
          Load lucky numbers
        </button>

        <div class="luckyArea">

          <div class="js-luckyEmpty">
            No lucky numbers yet.
          </div>

          <div class="js-luckyLoader">
            <!-- Check JS -->
          </div>

          <div class="js-luckyTarget js-isHidden">
            <p>The lucky numbers are <span class="js-luckyNrs"></span>.</p>
          </div>
        </div>
        <p>A <a href="#fake-link" class="link">dummy link</a> for demo.</p>
      </form>
    </div>

  </main>

  <script>
    const elLuckyTrigger = document.getElementsByClassName('js-luckyTrigger')[0];
    const elLuckyLoader = document.getElementsByClassName('js-luckyLoader')[0];
    const elLuckyEmpty = document.getElementsByClassName('js-luckyEmpty')[0];
    const elLuckyTarget = document.getElementsByClassName('js-luckyTarget')[0];
    const elLuckyNrs = document.getElementsByClassName('js-luckyNrs')[0];

    const getRandomNr = () => Math.floor(Math.random() * 9) + 1;
    const loadingTime = 2500 // 2.5s          

    elLuckyTrigger.addEventListener('click', function (e) {
      const isDisabled = ignoreIfDisabled(e)
      if (isDisabled) return false

      elLuckyTrigger.setAttribute('disabled', 'disabled')
      elLuckyEmpty.classList.add('js-isHidden')

      elLuckyLoader.innerHTML = `Loading numbers...`

      elLuckyTarget.classList.add('js-isHidden');

      setTimeout(() => {
        // Display the lucky numbers!
        elLuckyNrs.textContent = `${getRandomNr()} and ${getRandomNr()}`
        elLuckyTarget.classList.remove('js-isHidden');

        // Make the trigger button clickable again. 
        elLuckyTrigger.removeAttribute('disabled');

        // Remove the loading message 
        elLuckyLoader.innerHTML = ''
      }, loadingTime)
    })

    function ignoreIfDisabled(event) {
      const isDisabled = event.target.getAttribute('aria-disabled') === 'true';

      if (isDisabled) {
        event.preventDefault();
        event.target.blur(); // prevent focus on click.
        console.log('disabled - click ignored')
        return true
      }

      return false
    }
  </script>
</body>

</html>